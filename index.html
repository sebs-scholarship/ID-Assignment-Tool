<html lang="en">
<head>
	<title>SSF ID Assignment Tool</title>
	<style>
	body {
		font-family: "Montserrat", Arial, sans-serif;
		text-align: center;
	}
	button {
		display: block;
		margin: 1rem auto;
		background-color: #800000;
		color: white;
		border: none;
		font-size: 1.2em;
		padding: 15px 32px;
	}
	div {
		display: inline-block;
		text-align:center;
		width: 400px
	}
	textarea {
		border: 1px solid #5D6369;
		border-radius: 5px;
	}
	p {
		color: #5D6369;
	}
	input {
		display: inline-block;
		vertical-align: middle;
		margin: 1rem auto;
	}
	</style>
</head>
<body>
		<div>
			<h1>SSF ID Assignment Tool</h1>
			<h2>Tool</h2>
			<p>Please enter each applicant's name on a separate line.</p>
			<textarea id=names rows=25 cols=50></textarea><br>
			<input type=checkbox id=sheets>Optimize for Google Sheets
			<button onClick="submit()">Generate</button>
			<h2>Results</h2>
			<p id=result>Results will appear here...</p>
			<h2>About</h2>
			<p>The SSF ID Assignment Tool was created to assist the SEBS Scholarship Foundation in assigning unique identifiers to scholarship applicants. We do this to ensure that applicants are given a fair and unbiased chance at receiving a scholarship.</p>
			<h2>How It Works</h2>
			<p>
			This tool was created with security in mind as we respect the privacy of our 
			applicants. Because of this, we knew that our ID tool had to be unbiased, and 
			generated independently of any personally identifying information. The algorithm 
			chooses random names from the list of names provided. Based on the order that names 
			were selected, we assign ID's that are uniformly distributed and unique for inputs 
			with 729,000,000 names or less. Because the names are randomly chosen, this
			process is not replicable, and therefore cannot be used to determine which IDs 
			were assigned, or to whom.
			</p>
		</div>
	<script>
		let charMap = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "B", "C", "D", "F", "G", "H", "J", "K", "L",
						"M", "N", "P", "Q", "R", "S", "T", "V", "W", "X", "Z"];
		let base = 30;
		let characters = 6;
		let maxID = Math.pow(base, characters);

		function toIDString(num) {
			let idString = "";
			let maxPow = Math.floor(Math.log(num) / Math.log(charMap.length));

			for (let i = maxPow; i >= 0; i--) {
				let pow = Math.pow(base, i);
				let index = Math.floor(num / pow);
				idString += charMap[index];
				num %= pow;
			}

			return ("0".repeat(characters) + idString).slice(-characters);
		}

		function getIDMap(names) {
			let idMap = {};
			let entries = names.length;
			let idOffset = maxID / entries;
			let initialOffset = Math.floor(Math.random() * idOffset);

			for (let i = 0; i < entries; i++) {
				let pos = Math.floor(Math.random() * names.length);
				let name = names[pos];
				names.splice(pos, 1);
				let id = initialOffset + Math.floor(i * idOffset);
				idMap[name] = toIDString(id);
			}

			return Object.entries(idMap);
		}

		function submit() {
			let namesRaw = document.getElementById("names").value.trim();
			if (namesRaw !== "") {
				let namesList = namesRaw.split("\n");
				if (namesList.length <= maxID) {
					let sheets = document.getElementById("sheets").checked;
					let idMap = getIDMap(namesList);
					let text = "";
					for (let i = 0; i < idMap.length; i++) {
						if (sheets) {
							text = text.concat(idMap[i][0], ",'", idMap[i][1], "<br>");
						} else {
							text = text.concat(idMap[i][0], ",", idMap[i][1], "<br>");
						}
					}
					document.getElementById("result").innerHTML = text;
				} else {
					alert("Please enter less than " + maxID + " names!")
				}
			}
		}
	</script>
</body>
</html>